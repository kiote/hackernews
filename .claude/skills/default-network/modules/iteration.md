# Multi-Cycle Iteration Protocol

## Why Multi-Cycle?

The brain's Default Mode Network isn't a linear pipeline—it's a network of **interacting subsystems** that constantly cycle and influence each other:

- **Medial temporal subsystem**: Memory, scene construction
- **Medial prefrontal subsystem**: Self-reflection, mentalizing
- **Core hubs**: Integration across subsystems

Single-pass or even single-cycle thinking cannot emulate this. True DMN emulation requires **multiple interacting cycles** that feed into each other, challenge each other, and produce emergent insight through their interaction.

---

## Architecture: The Cycle Network

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           ULTRATHINK CYCLE NETWORK                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│                        ┌─────────────────────────┐                          │
│                        │      METACOGNITION      │                          │
│                        │  "Is this productive?"  │                          │
│                        │  "Change strategy?"     │                          │
│                        └───────────┬─────────────┘                          │
│                                    │ modulates all cycles                   │
│                 ┌──────────────────┼──────────────────┐                     │
│                 │                  │                  │                     │
│                 ▼                  ▼                  ▼                     │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐          │
│  │   MODE CYCLE     │  │   ZOOM CYCLE     │  │  MEMORY CYCLE    │          │
│  │                  │  │                  │  │                  │          │
│  │  ┌──►ASSOCIATE   │  │  MICRO ◄──► MACRO│  │ EXPLORE ──► SLEEP│          │
│  │  │      │        │  │    │         │   │  │    ▲        │    │          │
│  │  │      ▼        │  │    └────┬────┘   │  │    └────────┘    │          │
│  │  │  PROSPECT     │  │         │        │  │   (consolidate)  │          │
│  │  │      │        │  │    oscillates    │  │                  │          │
│  │  │      ▼        │  │                  │  └──────────────────┘          │
│  │  │   WANDER      │  └──────────────────┘            │                   │
│  │  │      │        │            │                     │                   │
│  │  │      ▼        │            │                     │                   │
│  │  │  CHALLENGE────┼────────────┼─────────────────────┘                   │
│  │  │      │        │            │                                         │
│  │  └──────┘        │            │                                         │
│  └──────────────────┘            │                                         │
│           │                      │                                         │
│           ▼                      ▼                                         │
│  ┌─────────────────────────────────────────────────────────────┐           │
│  │                    CROSS-DOMAIN CYCLE                        │           │
│  │                                                              │           │
│  │    Domain A ──► insight ──► Domain B ──► insight ──► ...    │           │
│  │         ▲                                      │             │           │
│  │         └──────────────────────────────────────┘             │           │
│  └─────────────────────────────────────────────────────────────┘           │
│                              │                                              │
│                              ▼                                              │
│                    ┌──────────────────┐                                     │
│                    │ GLOBAL CONVERGE? │                                     │
│                    └────────┬─────────┘                                     │
│                             │                                               │
│              ┌──────────────┴──────────────┐                                │
│              │ No                          │ Yes                            │
│              ▼                             ▼                                │
│     ┌────────────────┐           ┌────────────────┐                         │
│     │ Continue cycles│           │   INTEGRATE    │                         │
│     └────────────────┘           └────────┬───────┘                         │
│                                           │                                 │
│                                           ▼                                 │
│                                  ┌────────────────┐                         │
│                                  │     OUTPUT     │                         │
│                                  └────────────────┘                         │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## The Five Cycles

### Cycle 1: MODE CYCLE (Core Cognitive Loop)

The primary cycle that rotates through cognitive modes:

```
ASSOCIATE ──► PROSPECT ──► WANDER ──► CHALLENGE ──┐
    ▲                                              │
    └──────────────────────────────────────────────┘
```

| Node | Function | Feeds Forward |
|------|----------|---------------|
| **ASSOCIATE** | Spread activation, find connections | Discoveries trigger future simulation |
| **PROSPECT** | Simulate futures, trace consequences | Gaps trigger exploration |
| **WANDER** | Explore unknown territory | Findings trigger scrutiny |
| **CHALLENGE** | Question everything, devil's advocate | Refined ideas restart association |

**Each node is a separate agent spawn.**

---

### Cycle 2: ZOOM CYCLE (Scale Oscillation)

Oscillates between micro (detailed) and macro (big picture) perspectives:

```
MICRO ◄──────────────────► MACRO
  │                          │
  │   (every 2 mode nodes)   │
  │                          │
  ▼                          ▼
Details, mechanisms,    Patterns, themes,
specific examples       abstractions
```

**Trigger**: After every 2 nodes in the mode cycle, force a zoom shift.

- If currently MICRO → next node operates in MACRO mode
- If currently MACRO → next node operates in MICRO mode

This prevents getting stuck at one level of abstraction.

---

### Cycle 3: MEMORY CYCLE (Consolidation)

Periodically "sleeps" on findings, then revisits with fresh perspective:

```
EXPLORE ──► CONSOLIDATE ──► REVISIT
    ▲                          │
    └──────────────────────────┘
```

| Phase | Function | Agent Instruction |
|-------|----------|-------------------|
| **EXPLORE** | Active exploration (mode cycle runs) | Normal operation |
| **CONSOLIDATE** | Compress findings to key insights | "Distill to 3 core insights" |
| **REVISIT** | Re-examine with only consolidated memory | "Given ONLY these insights, what do you now see?" |

**Trigger**: After every full mode cycle (4 nodes), run consolidation.

---

### Cycle 4: CROSS-DOMAIN CYCLE (Analogical Transfer)

Each insight triggers search for analogies in unrelated domains:

```
Domain A ──► insight ──► "What domain is this like?" ──► Domain B
                                                              │
                                                              ▼
                                                         new insight
                                                              │
                                                              ▼
                                                    "What domain is THIS like?"
                                                              │
                                                              ▼
                                                          Domain C
                                                             ...
```

**Domains rotate through**: Biology, Physics, Economics, Music, Architecture, Games, Ecology, Military, Cooking, Sports, etc.

**Each cross-domain connection spawns a mini-exploration.**

---

### Cycle 5: METACOGNITION CYCLE (Strategic Oversight)

Runs in parallel, monitoring and modulating all other cycles:

```
┌─────────────────────────────────────────────┐
│              METACOGNITION                   │
│                                              │
│  After every 3 agent spawns, evaluate:       │
│                                              │
│  1. Is this productive? (novelty check)      │
│  2. Are we stuck? (loop detection)           │
│  3. Should we change strategy?               │
│  4. What's the current best insight?         │
│  5. What's missing?                          │
│                                              │
│  Can trigger:                                │
│  - Force zoom shift                          │
│  - Force domain shift                        │
│  - Force consolidation                       │
│  - Inject new seed                           │
│  - Trigger convergence                       │
└─────────────────────────────────────────────┘
```

---

## Execution Protocol

### Step 1: Initialize

```bash
mkdir -p .claude/skills/default-network/state/ultrathink
```

```json
{
  "session_id": "ultrathink_<timestamp>",
  "query": "<original query>",
  "mode_cycle_position": 0,
  "zoom_state": "macro",
  "domains_used": [],
  "consolidations": 0,
  "total_agents_spawned": 0,
  "insights": [],
  "convergence": {
    "global_converged": false,
    "reason": null
  }
}
```

### Step 2: Execute Mode Cycle (Primary Loop)

**Node 1: ASSOCIATE**

```
Task tool:
  subagent_type: general-purpose
  prompt: |
    You are DMN ASSOCIATE node.

    QUERY: [query]
    ZOOM LEVEL: [macro/micro]
    PREVIOUS CONTEXT: [if any]

    YOUR TASK:
    Spread activation from seed concepts. Find connections.

    If MACRO: Focus on broad patterns, themes, category-level connections
    If MICRO: Focus on specific mechanisms, details, concrete examples

    OUTPUT:
    ## ASSOCIATE [macro/micro]

    ### Seed Concepts
    [extracted from query/context]

    ### Connections Found
    - [Concept A] ──connects to──► [Concept B] because [reason]
    - [repeat for 5-8 connections]

    ### Strongest Connection
    [which connection is most interesting and why]

    ### Forward to PROSPECT
    [what futures should be simulated based on these connections?]

    ### Concepts Introduced
    [list for novelty tracking]
```

**Node 2: PROSPECT**

```
Task tool:
  subagent_type: general-purpose
  prompt: |
    You are DMN PROSPECT node.

    INPUT FROM ASSOCIATE:
    [paste associate output]

    ZOOM LEVEL: [opposite of associate - if associate was macro, this is micro]

    YOUR TASK:
    Simulate futures. Trace consequences. Generate scenarios.

    If MACRO: Big-picture scenarios, systemic effects, long-term trends
    If MICRO: Specific sequences, detailed mechanisms, immediate effects

    OUTPUT:
    ## PROSPECT [macro/micro]

    ### Futures Simulated

    **Scenario 1: [name]**
    - Trigger: [what causes this]
    - Sequence: [step by step]
    - Outcome: [end state]
    - Likelihood: [high/medium/low]

    **Scenario 2: [name]**
    [repeat]

    **Scenario 3: [name]**
    [repeat]

    ### Consequences Traced
    - If [X] then [Y] then [Z]
    - [repeat for key chains]

    ### Gaps Identified
    [what couldn't you simulate? what's unknown?]

    ### Forward to WANDER
    [what territories need exploration to fill gaps?]

    ### Concepts Introduced
    [list for novelty tracking]
```

**Node 3: WANDER**

```
Task tool:
  subagent_type: general-purpose
  prompt: |
    You are DMN WANDER node.

    GAPS FROM PROSPECT:
    [paste gaps identified]

    ZOOM LEVEL: [macro/micro]

    YOUR TASK:
    Explore freely. Drift through concept space. Find unexpected territory.

    If MACRO: Wander across domains, big conceptual leaps
    If MICRO: Wander within a domain, find hidden details

    CONSTRAINT: You MUST explore at least one territory that seems
    irrelevant at first. Trust the drift.

    OUTPUT:
    ## WANDER [macro/micro]

    ### Exploration Path
    Started at: [gap/question]

    Step 1: [concept] → led to thinking about → [next concept]
    Step 2: [concept] → led to thinking about → [next concept]
    [continue for 5-8 steps]

    Ended at: [unexpected territory]

    ### Surprising Finds
    - [something unexpected discovered]
    - [something that seemed irrelevant but isn't]

    ### New Territory Mapped
    [describe the new conceptual space found]

    ### Forward to CHALLENGE
    [what should be questioned about everything so far?]

    ### Concepts Introduced
    [list for novelty tracking]
```

**Node 4: CHALLENGE**

```
Task tool:
  subagent_type: general-purpose
  prompt: |
    You are DMN CHALLENGE node (Devil's Advocate).

    ALL PREVIOUS IN THIS CYCLE:
    [paste ASSOCIATE, PROSPECT, WANDER outputs]

    ZOOM LEVEL: [macro/micro]

    YOUR TASK:
    Question EVERYTHING. Find flaws. Play devil's advocate.
    Be genuinely skeptical, not performatively.

    If MACRO: Challenge big assumptions, systemic beliefs
    If MICRO: Challenge specific claims, mechanisms, details

    OUTPUT:
    ## CHALLENGE [macro/micro]

    ### Assumptions Exposed
    | Claim | Hidden Assumption | Why It Might Be Wrong |
    |-------|-------------------|----------------------|
    | [claim from previous] | [assumption] | [challenge] |
    [repeat for 5+ assumptions]

    ### Strongest Challenges

    **Challenge 1: [target claim]**
    - The claim assumes: [assumption]
    - But actually: [counter-evidence/logic]
    - If wrong, then: [implications]

    **Challenge 2: [target claim]**
    [repeat]

    ### What Survives Scrutiny
    [which ideas hold up under challenge?]

    ### Refined Understanding
    [how does the picture change after challenges?]

    ### Forward to ASSOCIATE (next cycle)
    [what seeds should the next association round start with?]

    ### Concepts Introduced
    [list for novelty tracking]
```

### Step 3: Trigger Zoom Shift

After every 2 nodes, flip zoom state:

```python
if agents_since_last_zoom >= 2:
    zoom_state = "micro" if zoom_state == "macro" else "macro"
    agents_since_last_zoom = 0
```

### Step 4: Trigger Cross-Domain (after each CHALLENGE)

After CHALLENGE completes, spawn cross-domain exploration:

```
Task tool:
  subagent_type: general-purpose
  prompt: |
    You are DMN CROSS-DOMAIN explorer.

    INSIGHT TO TRANSFER:
    [strongest insight from the cycle]

    SOURCE DOMAIN: [domain of the query]

    TARGET DOMAIN: [randomly selected from unused domains]
    Available: Biology, Physics, Economics, Music, Architecture,
              Games, Ecology, Military Strategy, Cooking, Sports,
              Theater, Law, Medicine, Mythology, Urban Planning

    YOUR TASK:
    Find deep structural analogies between the insight and the target domain.

    OUTPUT:
    ## CROSS-DOMAIN: [source] → [target]

    ### The Insight
    [restate the insight being transferred]

    ### Structural Mapping
    | Source Concept | Target Analog | Shared Structure |
    |----------------|---------------|------------------|
    | [concept] | [analog in target] | [what's similar] |
    [repeat for 3-5 mappings]

    ### What the Analogy Reveals
    [new understanding gained from seeing it in target domain]

    ### Import Back
    [what can we import from target domain back to source?]

    ### New Seed
    [new question/direction arising from this transfer]
```

### Step 5: Trigger Consolidation (after full mode cycle)

After all 4 mode nodes complete, run consolidation:

```
Task tool:
  subagent_type: general-purpose
  prompt: |
    You are DMN CONSOLIDATE (Memory Compression).

    FULL CYCLE OUTPUT:
    [paste all 4 mode nodes + cross-domain]

    YOUR TASK:
    Compress everything to essential insights. Simulate "sleep"
    where only important patterns are retained.

    OUTPUT:
    ## CONSOLIDATION

    ### Retained Insights (max 5)
    1. [core insight - one sentence]
    2. [core insight - one sentence]
    3. [core insight - one sentence]
    [etc.]

    ### Discarded
    [what seemed important but isn't - let it go]

    ### Strengthened Connections
    [which connections became stronger through repetition?]

    ### Ready for Fresh Look
    [compressed memory ready for revisit]
```

Then spawn REVISIT:

```
Task tool:
  subagent_type: general-purpose
  prompt: |
    You are DMN REVISIT (Fresh Perspective).

    YOU ONLY KNOW THIS:
    [paste ONLY the consolidated insights, not full history]

    ORIGINAL QUERY:
    [query]

    YOUR TASK:
    With ONLY this compressed memory, what do you see now?
    What new connections appear? What was missed?

    OUTPUT:
    ## REVISIT (Fresh Eyes)

    ### What I See Now
    [interpretation with only consolidated memory]

    ### New Connections
    [connections that appear with fresh perspective]

    ### What's Missing
    [gaps visible now that weren't before]

    ### Seeds for Next Cycle
    [what should we explore next?]
```

### Step 6: Metacognition Check (every 3 agents)

```
After every 3 agent spawns:

METACOGNITION EVALUATION:

1. Novelty Check
   - New concepts this window: [count]
   - Novelty rate: [new / total]%
   - Status: [healthy / declining / stagnant]

2. Loop Detection
   - Repeated themes: [list]
   - Cycling without progress? [yes/no]

3. Strategy Assessment
   - Current strategy: [describe]
   - Effectiveness: [high/medium/low]
   - Recommended change: [none / shift zoom / shift domain / inject seed / converge]

4. Best Current Insight
   - [the strongest insight so far]

5. Biggest Gap
   - [what's most missing]

ACTION:
Based on assessment, trigger one of:
- CONTINUE (no change)
- FORCE_ZOOM (immediate perspective shift)
- FORCE_DOMAIN (bring in specific domain)
- INJECT_SEED (add new starting point)
- CONVERGE (end cycles, integrate)
```

### Step 7: Global Convergence

Convergence triggers when ANY:

1. **Saturation**: Novelty < 15% for 2 consecutive consolidations
2. **Crystallization**: Same core insight appears in 3+ challenges
3. **Completion**: All identified gaps have been explored
4. **Resource limit**: 20 agents spawned

### Step 8: Final Integration

```
Task tool:
  subagent_type: general-purpose
  prompt: |
    You are DMN INTEGRATOR (Final Synthesis).

    ORIGINAL QUERY:
    [query]

    ALL CYCLE OUTPUTS:
    [paste everything]

    CONSOLIDATION HISTORY:
    [paste all consolidations]

    CROSS-DOMAIN TRANSFERS:
    [paste all cross-domain outputs]

    YOUR TASK:
    This is the final synthesis. Find what EMERGED from the
    interaction of cycles that wasn't in any single cycle.

    OUTPUT:
    ## ULTRATHINK FINAL SYNTHESIS

    ### Query
    [original query]

    ### Cycle Journey
    - Mode cycles completed: [N]
    - Zoom oscillations: [N]
    - Cross-domain transfers: [list domains]
    - Consolidations: [N]
    - Total agents: [N]

    ### Emergent Insights
    [Patterns that emerged from CYCLE INTERACTIONS]

    1. **[Insight Name]**
       - Emerged from interaction of: [which cycles]
       - Not visible in any single pass
       - Evidence: [how we know this is emergent]

    2. **[Insight Name]**
       [repeat]

    ### Central Theme
    [The unifying insight]

    [3-4 paragraph deep explanation]

    ### Key Tensions Resolved
    | Tension | Resolution | What It Teaches |
    |---------|------------|-----------------|
    | [opposing views] | [how resolved] | [insight] |

    ### Cross-Domain Synthesis
    [What the domain transfers revealed collectively]

    ### Implications
    1. [Implication]
    2. [Implication]
    3. [Implication]

    ### Remaining Unknowns
    [What honest uncertainty remains]

    ### Final Answer
    [Direct response to original query, informed by all cycles]

    ---
    ULTRATHINK COMPLETE
    Cycles: [N mode cycles]
    Agents: [total spawned]
    Convergence: [reason]
    Core insight: [one sentence]
```

---

## State Tracking

### state/ultrathink/session.json

```json
{
  "session_id": "ultrathink_20250125_143022",
  "query": "...",
  "cycles": [
    {
      "cycle_num": 1,
      "nodes": ["associate", "prospect", "wander", "challenge"],
      "zoom_sequence": ["macro", "micro", "macro", "micro"],
      "cross_domain": "biology",
      "consolidated": true,
      "novelty_at_end": 45
    }
  ],
  "domains_used": ["biology", "economics"],
  "total_agents": 12,
  "insights": [
    {"cycle": 1, "insight": "...", "strength": "high"},
    {"cycle": 2, "insight": "...", "strength": "medium"}
  ],
  "metacognition_interventions": [
    {"at_agent": 6, "action": "FORCE_ZOOM"},
    {"at_agent": 9, "action": "INJECT_SEED"}
  ],
  "convergence": {
    "triggered_at_agent": 15,
    "reason": "crystallization",
    "final_insight": "..."
  }
}
```

---

## Quick Reference: Agent Spawn Order

Typical execution (may vary based on metacognition):

```
1.  ASSOCIATE (macro)
2.  PROSPECT (micro)         ← zoom shift
3.  WANDER (micro)
4.  CHALLENGE (macro)        ← zoom shift
5.  CROSS-DOMAIN
6.  CONSOLIDATE
7.  REVISIT
    [metacognition check]
8.  ASSOCIATE (macro)        ← cycle 2 starts
9.  PROSPECT (micro)
10. WANDER (macro)           ← zoom shift
11. CHALLENGE (micro)
12. CROSS-DOMAIN
13. CONSOLIDATE
14. REVISIT
    [metacognition check → converge]
15. INTEGRATE
```

---

## Failure Recovery

| Failure | Recovery |
|---------|----------|
| Agent timeout | Retry once, then skip node |
| Novelty stuck at 0 | Inject random domain seed |
| All challenges fail | Force wander to new territory |
| Cross-domain shallow | Try different domain |
| Integration too long | Summarize consolidations only |

---

## Why This Works

The multi-cycle architecture emulates key DMN properties:

| Brain DMN Property | Architecture Element |
|--------------------|---------------------|
| Subsystem interaction | Mode cycle + cross-connections |
| Spontaneous cognition | WANDER node |
| Self-referential processing | METACOGNITION cycle |
| Scene construction | PROSPECT simulations |
| Memory consolidation | CONSOLIDATE + REVISIT |
| Analogical reasoning | CROSS-DOMAIN cycle |
| Attentional flexibility | ZOOM oscillation |

The cycles interact and modulate each other, producing emergent insight that no single cycle could generate alone.
